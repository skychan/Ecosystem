<?xml version="1.0" encoding="UTF-8"?>
<agent version="1" agentcomment="This is an agent." agentclassname="Machine" agentparentclassname="" agentinterfaces="" agentimports="">
  <behaviorsteps>
    <behaviorstep x="139" y="31" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="ecosystem.Task" watchannotationtargetfieldnames="inNeed" watchannotationtriggercondition="$watchee.inNeed" watchannotationtriggerschedule="0" watchannotationtriggerdelta="" watchannotationtriggerpriority="" watchannotationpick="" comment="Response to the need call" visibility="0" returntype="void" compiledname="Response" parameters="ecosystem.Task watchedAgent" exceptions="">
      <label x="139" y="16" text="Response"/>
    </behaviorstep>
    <behaviorstep x="884" y="421" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Change the service rank with depends on the review" visibility="0" returntype="def" compiledname="getRank" parameters="" exceptions="">
      <label x="884" y="406" text="Get the provider&apos;s rank"/>
    </behaviorstep>
    <behaviorstep x="769" y="418" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Add review to history" visibility="0" returntype="def" compiledname="AddReview" parameters="rvalue" exceptions="">
      <label x="769" y="403" text="Add review"/>
    </behaviorstep>
    <behaviorstep x="104" y="568" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Chose the next task" visibility="0" returntype="def" compiledname="Next" parameters="" exceptions="">
      <label x="104" y="553" text="Next"/>
    </behaviorstep>
    <behaviorstep x="577" y="686" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Review and comment after the task is finished" visibility="0" returntype="def" compiledname="Review" parameters="theTask" exceptions="">
      <label x="577" y="671" text="Review self"/>
    </behaviorstep>
    <behaviorstep x="306" y="1014" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="This is the step behavior." visibility="0" returntype="int" compiledname="getFullLength" parameters="" exceptions="">
      <label x="306" y="999" text="Full queue length"/>
    </behaviorstep>
    <behaviorstep x="356" y="384" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="This is the step behavior." visibility="0" returntype="void" compiledname="Assign" parameters="job" exceptions="">
      <label x="356" y="369" text="Assign"/>
    </behaviorstep>
    <behaviorstep x="532" y="48" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="This is the step behavior." visibility="0" returntype="void" compiledname="Release" parameters="Task t" exceptions="">
      <label x="532" y="33" text="Release"/>
    </behaviorstep>
  </behaviorsteps>
  <tasksteps>
    <taskstep x="138" y="279" comment="change the compete state" command1="this.competeList &lt;&lt; watchedAgent" command2="watchedAgent.addCandidates(this)" command3="//println this.toString() + &quot; compete &quot; + watchedAgent.toString()" command4="" command5="">
      <label x="138" y="264" text="Change the comoete state"/>
    </taskstep>
    <taskstep x="885" y="516" comment="This is a task." command1="PureProvider user = this.owner[-1]" command2="returnValue = user.getRank()" command3="" command4="" command5="">
      <label x="885" y="501" text="Do Task"/>
    </taskstep>
    <taskstep x="770" y="513" comment="This is a task." command1="//println &quot;add demander&apos;s review to the history&quot;" command2="this.reviews &lt;&lt; rvalue" command3="" command4="" command5="">
      <label x="770" y="498" text="Do Task"/>
    </taskstep>
    <taskstep x="282" y="583" comment="This is a task." command1="this.assignBehavior.Queue(job,this)" command2="" command3="" command4="" command5="">
      <label x="282" y="568" text="Do Task"/>
    </taskstep>
    <taskstep x="428" y="583" comment="This is a task." command1="this.buffer &lt;&lt; job" command2="this.setAvailable(this.getAvailable()-job.needResourceCapacity[this.getType()])" command3="job.prepareStatus[this.getType()] = true" command4="job.CheckStatus()" command5="">
      <label x="428" y="568" text="Do Task"/>
    </taskstep>
    <taskstep x="355" y="475" comment="This is a task." command1="" command2="" command3="" command4="" command5="">
      <label x="355" y="460" text="Do Task"/>
    </taskstep>
    <taskstep x="188" y="758" comment="This is a task." command1="this.buffer &lt;&lt; theOne" command2="this.setAvailable(this.getAvailable()-theOne.needResourceCapacity[this.getType()])" command3="theOne.prepareStatus[this.getType()] = true" command4="this.shiftTask &lt;&lt; theOne" command5="this.setQueue(false)">
      <label x="188" y="743" text="Do Task"/>
    </taskstep>
    <taskstep x="580" y="767" comment="This is a task." command1="double q = theTask.getProductQuality()" command2="int t = theTask.responseTime[this]" command3="double h = theTask.getHardness()" command4="int p = theTask.getProcessingTime()" command5="this.reviews &lt;&lt;  (h * q / (t+p))">
      <label x="580" y="752" text="Do Task"/>
    </taskstep>
    <taskstep x="190" y="851" comment="This is a task." command1="this.queueLength -= 1" command2="println this.toString() + &quot; with type &quot;+ this.getType()+ &quot; queue length=&quot; + this.getQueueLength()" command3="double t = RunEnvironment.getInstance().getCurrentSchedule().getTickCount()" command4="int delta = t - theOne.getChosenTime()" command5="theOne.responseTime[this] = delta\ftheOne.inBufferTime[this] = t">
      <label x="190" y="836" text="Do Task"/>
    </taskstep>
    <taskstep x="103" y="807" comment="This is a task." command1="this.jobList.remove(theOne)" command2="" command3="" command4="" command5="">
      <label x="103" y="792" text="Do Task"/>
    </taskstep>
    <taskstep x="24" y="725" comment="This is a task." command1="this.shiftTask = []" command2="this.owner[0].ServiceCall()" command3="" command4="" command5="">
      <label x="24" y="710" text="Do Task"/>
    </taskstep>
    <taskstep x="307" y="1119" comment="This is a task." command1="returnValue = this.jobList.size() + this.buffer.size()" command2="" command3="" command4="" command5="">
      <label x="307" y="1104" text="Do Task"/>
    </taskstep>
    <taskstep x="581" y="844" comment="This is a task." command1="this.owner.addTaskFrequency(theTask)" command2="" command3="" command4="" command5="">
      <label x="581" y="829" text="Do Task"/>
    </taskstep>
    <taskstep x="531" y="134" comment="This is a task." command1="releaseBehavior.Release(t,this)" command2="" command3="" command4="" command5="">
      <label x="531" y="119" text="Do Task"/>
    </taskstep>
  </tasksteps>
  <decisionsteps>
    <decisionstep x="139" y="110" comment="Decide to take the task or not" criteria="true" branchType="if">
      <label x="139" y="95" text="Take it or not"/>
    </decisionstep>
    <decisionstep x="138" y="195" comment="This is an agent decision." criteria="responseBehavior.Exist(watchedAgent,this)" branchType="if">
      <label x="138" y="180" text="Evaluate Criteria"/>
    </decisionstep>
    <decisionstep x="354" y="556" comment="This is an agent decision." criteria="this.assignBehavior.BufferEnterance(job,this)" branchType="if">
      <label x="354" y="541" text="Evaluate Criteria"/>
    </decisionstep>
    <decisionstep x="195" y="655" comment="This is an agent decision." criteria="this.getAvailable() &gt;= theOne.needResourceCapacity[this.getType()]" branchType="if">
      <label x="195" y="640" text="Evaluate Criteria"/>
    </decisionstep>
    <decisionstep x="104" y="652" comment="This is a loop." criteria="theOne in this.jobList" branchType="while">
      <label x="104" y="637" text="Evaluate Criteria"/>
    </decisionstep>
    <decisionstep x="101" y="736" comment="This is a loop." criteria="theOne in this.shiftTask" branchType="while">
      <label x="101" y="721" text="Evaluate Criteria"/>
    </decisionstep>
  </decisionsteps>
  <joinsteps>
    <joinstep x="366" y="711"/>
  </joinsteps>
  <agentproperties>
    <agentproperty x="43" y="35" comment="This is an agent property." visibility="0" compiledname="type" type="def" defaultvalue="0">
      <label x="48" y="20" text="Type"/>
    </agentproperty>
    <agentproperty x="282" y="27" comment="This is an agent property." visibility="0" compiledname="responseBehavior" type="ResponseBehavior" defaultvalue="null">
      <label x="287" y="12" text="ResponseBehavior"/>
    </agentproperty>
    <agentproperty x="41" y="133" comment="This is an agent property." visibility="0" compiledname="CompeteList" type="def" defaultvalue="[]">
      <label x="46" y="118" text="Compete List"/>
    </agentproperty>
    <agentproperty x="908" y="17" comment="Record the master of the resource" visibility="0" compiledname="master" type="Service" defaultvalue="null">
      <label x="913" y="2" text="Master"/>
    </agentproperty>
    <agentproperty x="792" y="40" comment="The service owner, if not only one" visibility="0" compiledname="owner" type="PureProvider" defaultvalue="null">
      <label x="797" y="25" text="Owner"/>
    </agentproperty>
    <agentproperty x="384" y="286" comment="Record be chose or not" visibility="0" compiledname="chose" type="boolean" defaultvalue="false">
      <label x="389" y="271" text="Chose"/>
    </agentproperty>
    <agentproperty x="885" y="161" comment="Count the finished jobs" visibility="0" compiledname="finish" type="int" defaultvalue="0">
      <label x="890" y="146" text="Finished"/>
    </agentproperty>
    <agentproperty x="964" y="212" comment="Quality" visibility="0" compiledname="quality" type="double" defaultvalue="0">
      <label x="969" y="197" text="Quality"/>
    </agentproperty>
    <agentproperty x="677" y="772" comment="Review history" visibility="0" compiledname="reviews" type="def" defaultvalue="[]">
      <label x="682" y="757" text="Review History"/>
    </agentproperty>
    <agentproperty x="441" y="404" comment="This is the task buffer" visibility="0" compiledname="buffer" type="List" defaultvalue="[]">
      <label x="446" y="389" text="Buffer"/>
    </agentproperty>
    <agentproperty x="300" y="894" comment="Mark queue in joblist or not" visibility="0" compiledname="queue" type="boolean" defaultvalue="false">
      <label x="305" y="879" text="Queue Status"/>
    </agentproperty>
    <agentproperty x="408" y="940" comment="This is an agent property." visibility="0" compiledname="queueLength" type="int" defaultvalue="0">
      <label x="413" y="925" text="Queue Length"/>
    </agentproperty>
    <agentproperty x="25" y="575" comment="This is an agent property." visibility="0" compiledname="shiftTask" type="def" defaultvalue="[]">
      <label x="30" y="560" text="Shift Task"/>
    </agentproperty>
    <agentproperty x="900" y="294" comment="This is an agent property." visibility="0" compiledname="chosenTime" type="double" defaultvalue="0">
      <label x="905" y="279" text="Chosen time"/>
    </agentproperty>
    <agentproperty x="250" y="414" comment="This is an agent property." visibility="0" compiledname="assignBehavior" type="AssignBehavior" defaultvalue="null">
      <label x="255" y="399" text="Assign Behavior"/>
    </agentproperty>
    <agentproperty x="619" y="55" comment="This is an agent property." visibility="0" compiledname="releaseBehavior" type="ReleaseBehavior" defaultvalue="null">
      <label x="624" y="40" text="Release Behavior"/>
    </agentproperty>
  </agentproperties>
  <endsteps>
    <endstep x="155" y="378"/>
    <endstep x="925" y="648"/>
    <endstep x="811" y="643"/>
    <endstep x="371" y="803"/>
    <endstep x="598" y="935"/>
    <endstep x="65" y="864"/>
    <endstep x="317" y="1224"/>
    <endstep x="535" y="237"/>
  </endsteps>
  <connections>
    <transitions>
      <transition>
        <transitionsource type="behavior" index="0" anchor="0"/>
        <transitiontarget type="decision" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="1" anchor="0"/>
        <transitiontarget type="task" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="2" anchor="0"/>
        <transitiontarget type="task" index="2" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="3" anchor="0"/>
        <transitiontarget type="decision" index="4" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="4" anchor="0"/>
        <transitiontarget type="task" index="7" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="5" anchor="0"/>
        <transitiontarget type="task" index="11" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="6" anchor="0"/>
        <transitiontarget type="task" index="5" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="0" anchor="2"/>
        <transitiontarget type="end" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="1" anchor="2"/>
        <transitiontarget type="end" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="2" anchor="2"/>
        <transitiontarget type="end" index="2" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="3" anchor="2"/>
        <transitiontarget type="join" index="0" anchor="1"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="4" anchor="2"/>
        <transitiontarget type="join" index="0" anchor="3"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="5" anchor="2"/>
        <transitiontarget type="decision" index="2" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="6" anchor="2"/>
        <transitiontarget type="task" index="8" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="7" anchor="2"/>
        <transitiontarget type="task" index="12" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="10" anchor="2"/>
        <transitiontarget type="end" index="5" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="11" anchor="2"/>
        <transitiontarget type="end" index="6" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="12" anchor="2"/>
        <transitiontarget type="end" index="4" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="join" index="0" anchor="2"/>
        <transitiontarget type="end" index="3" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="7" anchor="0"/>
        <transitiontarget type="task" index="13" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="13" anchor="2"/>
        <transitiontarget type="end" index="7" anchor="0"/>
        <bendpoints/>
      </transition>
    </transitions>
    <booleantransitions>
      <booleantransition value="true">
        <transitionsource type="decision" index="0" anchor="2"/>
        <transitiontarget type="decision" index="1" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="1" anchor="2"/>
        <transitiontarget type="task" index="0" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="2" anchor="1"/>
        <transitiontarget type="task" index="3" anchor="3"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="2" anchor="3"/>
        <transitiontarget type="task" index="4" anchor="1"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="3" anchor="2"/>
        <transitiontarget type="task" index="6" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="4" anchor="3"/>
        <transitiontarget type="decision" index="3" anchor="1"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="4" anchor="2"/>
        <transitiontarget type="decision" index="5" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="5" anchor="2"/>
        <transitiontarget type="task" index="9" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="5" anchor="1"/>
        <transitiontarget type="task" index="10" anchor="3"/>
        <bendpoints/>
      </booleantransition>
    </booleantransitions>
  </connections>
</agent>